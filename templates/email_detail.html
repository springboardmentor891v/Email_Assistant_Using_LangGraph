{% extends "base.html" %}

{% block title %}Email Details{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Back Button -->
    <div class="mb-6">
        <a href="{{ url_for('emails.email_list') }}" class="text-purple-600 hover:text-purple-800 font-medium">
            <i class="fas fa-arrow-left mr-2"></i>
            Back to Emails
        </a>
    </div>

    {% if error %}
    <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6">
        <i class="fas fa-exclamation-circle mr-2"></i>
        {{ error }}
    </div>
    {% endif %}

    {% if email %}
    <!-- Email Container -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white p-6">
            <div class="flex items-start justify-between">
                <div class="flex-1">
                    <h1 class="text-2xl font-bold mb-2">{{ email.subject or '(No subject)' }}</h1>
                    <p class="text-purple-100">{{ email.sender }}</p>
                </div>

                <!-- Triage Badge -->
                <span class="px-4 py-2 rounded-full font-semibold
                           {% if email.triage.category == 'IGNORE' %}bg-gray-200 text-gray-800
                           {% elif email.triage.category == 'NOTIFY' %}bg-blue-200 text-blue-900
                           {% elif email.triage.category == 'RESPOND' %}bg-purple-200 text-purple-900
                           {% else %}bg-yellow-200 text-yellow-900{% endif %}">
                    {{ email.triage.category }}
                </span>
            </div>
        </div>

        <!-- Email Info -->
        <div class="p-6 border-b border-gray-200">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div>
                    <span class="text-gray-500">From:</span>
                    <span class="ml-2 text-gray-900 font-medium">{{ email.sender }}</span>
                </div>
                <div>
                    <span class="text-gray-500">Date:</span>
                    <span class="ml-2 text-gray-900">{{ email.date }}</span>
                </div>
            </div>
        </div>

        <!-- AI Analysis -->
        <div class="p-6 bg-purple-50 border-b border-gray-200">
            <h3 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-robot text-purple-600 mr-2"></i>
                AI Analysis
            </h3>
            <p class="text-gray-700">{{ email.triage.reasoning }}</p>
        </div>

        <!-- Email Body -->
        <div class="p-6">
            <h3 class="font-semibold text-gray-900 mb-3">Message</h3>
            <div class="prose max-w-none">
                <pre class="whitespace-pre-wrap font-sans text-gray-700 leading-relaxed">{{ email.body }}</pre>
            </div>
        </div>

        <!-- Actions -->
        <div class="p-6 bg-gray-50 border-t border-gray-200">
            <div class="flex space-x-3">
                {% if email.triage.category == 'RESPOND' %}
                <button onclick="draftReply('{{ email.id }}')"
                    class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition">
                    <i class="fas fa-pen mr-2"></i>
                    Draft Reply
                </button>
                {% endif %}
                <button onclick="copyToClipboard(`{{ email.body|replace('`', '\\`') }}`)"
                    class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition">
                    <i class="fas fa-copy mr-2"></i>
                    Copy
                </button>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
    function draftReply(emailId) {
        window.location.href = `/emails?draft=${emailId}`;
    }
</script>
{% endblock %}